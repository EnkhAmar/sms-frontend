(this.webpackJsonpemilus=this.webpackJsonpemilus||[]).push([[20],{606:function(e,t,a){},615:function(e,t,a){},616:function(e,t,a){},660:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(529),c=a(525),s=a(66),o=a(10),u=(a(551),a(542),a(229)),i=a(490),d=a(1),b=r.a.createContext(),h=function(e){e.index,e.row,e.cells;var t=Object(u.a)(e,["index","row","cells"]),a=i.a.useForm(),n=Object(s.a)(a,1)[0];return Object(d.jsx)(i.a,{form:n,component:!1,children:Object(d.jsx)(b.Provider,{value:n,children:Object(d.jsx)("tr",Object(o.a)({},t))})})},p=a(305),j=a(491),f=a(607),O=a(77),m=a(601),v=(a(606),a(76)),x=a.n(v),y={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("userToken"))}},g=function(e){e.title;var t=e.editable,a=e.children,r=e.dataIndex,l=e.record,c=e.handleSave,s=e.inputType,o=e.required,b=e.datasheetStatus,h=e.lesson,v=(e.attributesRenderer,e.editing),g=(e.updated,e.row),w=e.col,_=e.cell,k=(e.onChange,e.onRevert),S=e.onKeyDown,I=Object(u.a)(e,["title","editable","children","dataIndex","record","handleSave","inputType","required","datasheetStatus","lesson","attributesRenderer","editing","updated","row","col","cell","onChange","onRevert","onKeyDown"]),C=Object(n.useRef)(),N=a;Object(n.useEffect)((function(){v&&"normal"===s&&C.current.focus()}),[v,s]);var T=[];switch(r){case"status":T=b.filter((function(e){return l.branch===e.branch}));break;case"lesson":T=h.filter((function(e){return l.branch===e.branch}));break;case"register_type":T=O.a;break;case"time":T=O.b}var D=function(e){c([{cell:_,row:g,col:w,value:e.target.value}]),k()},R=a;if(t){var E;switch(s){case"select":E=0===l.id&&"user_phone"===r?Object(d.jsx)(m.a,{initialValue:_.value,autoFocus:!0,openOnFocus:!0,closeOnSelect:!0,onChange:function(e){console.log(e),0!=e.id?c([{cell:_,row:g,col:w,value:e,existing:!0}]):c([{cell:_,row:g,col:w,value:e.phone}]),k()},onSelect:function(){return console.log("dwqdwqwd")},loadOptions:function(e,t){null!==l.branch?e.length<8||x.a.get("".concat(O.d,"/api/auth/action/?branch=").concat(l.branch,"&phone=").concat(e),y).then((function(a){0!=a.data.data.length?t(a.data.data):t([{phone:e,id:0}])})).catch((function(e){return console.log(e.response.data)})):p.b.error("Select branch!")},onInputKeyDown:function(e){return console.log(e)},name:"name",theme:{borderRadius:0},getOptionLabel:function(e){return e.phone},getOptionValue:function(e){return e.id},isDisabled:null===l.branch}):Object(d.jsx)(f.a,{initialValue:_.value,autoFocus:!0,openOnFocus:!0,closeOnSelect:!0,isSearchable:!0,onChange:function(e){c([{cell:_,row:g,col:w,value:e.id}]),k()},name:"name",theme:{borderRadius:0},getOptionLabel:function(e){return e.name},getOptionValue:function(e){return e.id},onInputKeyDown:S,isDisabled:null===l.branch,options:T});break;case"date":E=Object(d.jsx)("input",{className:"date-input",type:"date",onChange:D});break;default:E=Object(d.jsx)(j.a,{onKeyDown:I.onKeyDown,ref:C,bordered:!1,onPressEnter:D})}R=v?Object(d.jsx)(i.a.Item,{style:{margin:0,minHeight:0},name:r,rules:[o?{required:!0,message:"Required"}:{required:!1}],children:E}):Object(d.jsx)("div",{className:"editable-cell-value-wrap",style:{textAlign:"center"},children:N})}return R},w=a(89),_=a(22),k=a(75),S=("Bearer ".concat(localStorage.getItem("userToken")),a(230)),I=a(17),C=a.n(I),N=a(52),T=a(611),D=a.n(T),R=a(550),E=a.n(R),q=(a(614),a(615),a(483)),B=a(581),F=a(165),K=a(544),L=void 0,V={headers:{"Content-type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("userToken"))}},P=[{readOnly:!0,dataIndex:"",className:"not-bold",width:"3%"},{value:"Status",readOnly:!0,className:"not-bold",width:"5%"},{value:"Phone",readOnly:!0,className:"not-bold",width:"7.5%"},{value:"Firstname",readOnly:!0,className:"not-bold",width:"10%"},{value:"Lastname",readOnly:!0,className:"not-bold",width:"10%"},{value:"Lesson",readOnly:!0,className:"not-bold",width:"7.5%"},{value:"Register Type",readOnly:!0,className:"not-bold",width:"7.5%"},{value:"Description",readOnly:!0,className:"not-bold",width:"20%"},{value:"Operator",readOnly:!0,className:"not-bold",width:"10%"},{value:"Time",readOnly:!0,className:"not-bold",width:"7.5%"},{value:"Date",readOnly:!0,className:"not-bold",width:"7.5%"}],A=function(e){return x.a.put("".concat(O.d,"/api/datasheet/action/").concat(e.id,"/"),e,V)},Y=function(e,t){return[{readOnly:!0,value:e,className:"not-bold"},{value:"",dataIndex:"status",inputType:"select",editable:!0},{value:"",dataIndex:"user_phone",inputType:"select",editable:!0},{value:"",dataIndex:"user_firstname",inputType:"normal",editable:!0},{value:"",dataIndex:"user_lastname",inputType:"normal",editable:!0},{value:"",dataIndex:"lesson",inputType:"select",editable:!0},{value:"",dataIndex:"register_type",inputType:"select",editable:!0},{value:"",dataIndex:"description",inputType:"normal",editable:!0},{value:"",dataIndex:"operator_firstname",inputType:"normal",readOnly:!0,editable:!1},{value:"",dataIndex:"time",inputType:"select",editable:!0},{value:"",dataIndex:"date",inputType:"date",editable:!0}]},z=function(e){return console.log(e,e.length),8!=e.length?(p.b.error("Phone number should be 8!"),!1):/[a-zA-Z]/.test(e)?(p.b.error("Phone number should not contain any letters!"),!1):"8"==e[0]||"9"==e[0]||(p.b.error("Invalid phone number!"),!1)},J=function(){var e=Object(_.d)((function(e){return e.filters})),t=Object(_.d)((function(e){return e.userLogin.user})),a=(Object(_.d)((function(e){return e.theme.currentTheme})),Object(n.useState)(!1)),r=Object(s.a)(a,2),l=r[0],i=r[1],b=Object(n.useState)([]),f=Object(s.a)(b,2),m=f[0],v=f[1],y=Object(n.useState)([]),I=Object(s.a)(y,2),T=I[0],R=I[1],J=Object(n.useState)([]),M=Object(s.a)(J,2),G=M[0],H=M[1],Z=Object(n.useState)([]),Q=Object(s.a)(Z,2),U=Q[0],W=Q[1],X=Object(n.useState)([]),$=Object(s.a)(X,2),ee=$[0],te=$[1],ae=Object(n.useState)({operator:t.role_id===k.e?t.id:null,status:null,lesson:null,search:null,day:3,date:null}),ne=Object(s.a)(ae,2),re=ne[0],le=ne[1],ce=Object(n.useCallback)((function(){i(!0),function(e){var t=Object(o.a)({},e);Object.keys(e).forEach((function(e){null===t[e]&&delete t[e]}));var a=Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join("&");return x.a.get("".concat(O.d,"/api/datasheet/action/?").concat(""===a?"":"&"+a),V)}(t.role_id===k.e?re:Object(o.a)(Object(o.a)({},e),re)).then((function(a){var n=[P],r=a.data.data.map((function(e,t){e.key=e.id+"datasheet";var a=Y(t+1);return n.push(a),e})),l=t.role_id===k.e?t.branch:e.branch;W([].concat(Object(c.a)(r),[{id:0,key:"0datasheet",user_phone:null,user_firstname:null,user_lastname:null,operator_firstname:t.firstname,register_type:null,description:null,time:null,user:null,operator:t.id,status:null,lesson:null,groups:k.j,branch:l}])),n.push(Y(n.length,(t.firstname,t.id,k.j))),te(n),i(!1)})).catch((function(e){console.log(e.response.data)}))}),[t,e,re]),se=Object(n.useCallback)((function(){var a=t.role_id===k.e?re:Object(o.a)(Object(o.a)({},e),re),n=[];0===T.length&&n.push("lesson"),0===m.length&&n.push("datasheet_status"),0!==n.length&&function(e,t){var a=Object(o.a)({},t);return Object.keys(t).forEach((function(e){null===a[e]&&delete a[e]})),x.a.post("".concat(O.d,"/api/utility/detail/"),Object(o.a)(Object(o.a)({projection:e},a),{},{groups:3}),V)}(["lesson","datasheet_status","user"],a).then((function(e){"lesson"in e.data.data&&R(e.data.data.lesson),"datasheet_status"in e.data.data&&v(e.data.data.datasheet_status),"user"in e.data.data&&H(e.data.data.user)})).catch((function(e){console.log(e.response.data)}))}),[t,re,e]),oe=function(){var e=Object(N.a)(C.a.mark((function e(t){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,A(t);case 3:if(!e.sent.data.success){e.next=6;break}return e.abrupt("return",!0);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),ce(),Object.keys(e.t0.response.data).forEach((function(t){p.b.error(t+": "+e.t0.response.data[t])}));case 12:return e.abrupt("return",!1);case 13:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),ue=function(e,t,a){a.cell,a.row,a.col;var n=a.value;Object(u.a)(a,["cell","row","col","value"]);delete e.id;var r,l=Object(o.a)(Object(o.a)(Object(o.a)({},e),t),{},{user_phone:n.phone,user_firstname:n.firstname,user_lastname:null===n.lastname?"":n.lastname});return(r=l,x.a.post("".concat(O.d,"/api/datasheet/action/"),JSON.stringify(r),V)).then((function(e){return ce(1)})).catch((function(e){ce(),Object.keys(e.response.data).forEach((function(t){p.b.error(t+": "+e.response.data[t])}))})),l},ie=function(){var e=Object(N.a)(C.a.mark((function e(t){var a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Object(c.a)(U),e.next=3,t.forEach(function(){var e=Object(N.a)(C.a.mark((function e(t){var n,r,l,c,s,i;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.cell,r=t.row,l=t.col,c=t.value,s=Object(u.a)(t,["cell","row","col","value"]),0!==(i=Object(o.a)({},a[r-1])).id){e.next=5;break}if(null!==i.branch||(p.b.error("Select branch!"),0)){e.next=5;break}return e.abrupt("return");case 5:if(!s.existing){e.next=8;break}return a[r-1]=ue(i,{user:c.id},Object(o.a)({cell:n,row:r,col:l,value:c},s)),e.abrupt("return");case 8:if("user_phone"!==n.dataIndex||z(c)){e.next=10;break}return e.abrupt("return");case 10:if(i[n.dataIndex]=c,a[r-1][n.dataIndex]=c,0!==i.id||!i.user_firstname||!i.user_phone){e.next=19;break}return delete i.user,i.phone=i.user_phone,i.lastname=i.user_lastname,i.firstname=i.user_firstname,a[r-1]=ue(i,{},Object(o.a)({cell:n,row:r,col:l,value:c},s)),e.abrupt("return");case 19:(0!=i.id&&"user_phone"===n.dataIndex||"user_firstname"===n.dataIndex||"user_lastname"===n.dataIndex)&&(a.forEach((function(e){e.user===i.user&&(e[n.dataIndex]=c)})),i.with_user=!0,i.phone=i.user_phone,i.lastname=i.user_lastname,i.firstname=i.user_firstname,i.groups=k.j),0!=i.id&&oe(i);case 21:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 3:W(a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(e,t){var a,n;"object"===typeof e?(a=e.target.name,n=e.target.value):(a="name"in t?t.name:"search",n=e),le("all"===e?Object(o.a)(Object(o.a)({},re),{},Object(S.a)({},a,null)):Object(o.a)(Object(o.a)({},re),{},Object(S.a)({},a,n)))},be=function(){null===e.branch&&p.b.error("Select branch!")},he=function(e){le(Object(o.a)(Object(o.a)({},re),{},Object(S.a)({},e,null)))};return Object(n.useEffect)((function(){ce(1),se()}),[e,re,ce,se]),Object(d.jsxs)("div",{className:"sheet-container",children:[Object(d.jsxs)(w.a,{justifyContent:"space-between",className:"filter-container",children:[Object(d.jsxs)(w.a,{justifyContent:"end",className:"filter-container",children:[Object(d.jsxs)(q.a.Group,{defaultValue:"3",value:re.day,name:"day",onChange:de,buttonStyle:"solid",children:[Object(d.jsx)(q.a.Button,{value:1,children:"1 day"}),Object(d.jsx)(q.a.Button,{value:3,children:"3 days"}),Object(d.jsx)(q.a.Button,{value:7,children:"7 days"})]}),Object(d.jsx)(B.a,{onSelect:function(e){le(Object(o.a)(Object(o.a)({},re),{},{day:-1,date:e.format("YYYY-MM-DD")}))},className:"select-width"})]}),Object(d.jsxs)(w.a,{justifyContent:"end",className:"filter-container",children:[Object(d.jsx)(F.a,{allowClear:!0,onClear:he.bind(L,"operator"),className:"select-width",onClick:t.role_id!==k.e?be:null,defaultValue:null===re.operator?null:re.operator,disabled:null===e.branch&&t.role_id!==k.e,placeholder:"Operator",onSelect:de,children:0!=G.length?G.map((function(e){return Object(d.jsxs)(F.a.Option,{name:"operator",value:e.id,children:[" ",e.firstname," "]},e.id+"datasheet-filter-operator")})):null}),Object(d.jsx)(F.a,{allowClear:!0,onClear:he.bind(L,"lesson"),className:"select-width",onClick:t.role_id!==k.e?be:null,disabled:null===e.branch&&t.role_id!==k.e,placeholder:"Lesson",onSelect:de,children:0!=T.length?T.map((function(e){return Object(d.jsxs)(F.a.Option,{name:"lesson",value:e.id,children:[" ",e.name," "]},e.id+"datasheet-filter-lesson")})):null}),Object(d.jsx)(F.a,{allowClear:!0,onClear:he.bind(L,"status"),className:"select-width",onClick:t.role_id!==k.e?be:null,disabled:null===e.branch&&t.role_id!==k.e,placeholder:"Datasheet Status",onSelect:de,children:0!=m.length?m.map((function(e){return Object(d.jsxs)(F.a.Option,{name:"status",value:e.id,children:[" ",e.name," "]},e.id+"datasheet-filter-status")})):null}),Object(d.jsx)(j.a.Search,{allowClear:!0,name:"search",onSearch:de,placeholder:"Search...",className:"select-width"})]})]}),l?Object(d.jsx)(w.a,{justifyContent:"center",children:Object(d.jsx)(K.a,{})}):Object(d.jsx)(D.a,{className:"test",data:ee,valueRenderer:function(e,t,a){if(0===U.length)return e.dataIndex;if(0===t||0===a)return e.value;var n,r=U[t-1][e.dataIndex],l=U[t-1];switch(e.dataIndex){case"status":if(null===l.status)break;r=null===(n=m.find((function(e){return e.id===l.status})))||void 0===n?e.value:n.name;break;case"lesson":if(null===l.lesson)break;r=null===(n=T.find((function(e){return e.id===l.lesson})))||void 0===n?e.value:n.name;break;case"register_type":if(null===l.register_type)break;r=null===(n=O.a.find((function(e){return e.id===l.register_type})))||void 0===n?e.value:n.name}return r},onContextMenu:function(e,t,a,n){return t.readOnly?e.preventDefault():null},rowRenderer:h,dataEditor:function(e){return"normal"===e.cell.inputType||"user_phone"===e.cell.dataIndex&&0!=U[e.row-1].id?Object(d.jsx)(E.a,Object(o.a)({},e)):Object(d.jsx)(g,Object(o.a)(Object(o.a)({},e),{},{editable:e.cell.editable,record:U[e.row-1],inputType:e.cell.inputType,datasheetStatus:m,lesson:T,dataIndex:e.cell.dataIndex,handleSave:ie,editing:!0}))},onCellsChanged:ie})]})},M=(a(616),a(509));t.default=function(){return Object(d.jsx)(l.a,{title:Object(d.jsxs)("h2",{children:[Object(d.jsx)(M.a,{})," Datasheet"]}),extra:null,children:Object(d.jsx)(J,{})})}}}]);
//# sourceMappingURL=20.4b7903ee.chunk.js.map